(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{393:function(s,t,a){"use strict";a.r(t);var e=a(29),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"express"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express"}},[s._v("#")]),s._v(" Express")]),s._v(" "),a("hr"),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#环境"}},[s._v("环境")])]),a("li",[a("a",{attrs:{href:"#一、安装"}},[s._v("一、安装")])]),a("li",[a("a",{attrs:{href:"#二、跑起来"}},[s._v("二、跑起来")])]),a("li",[a("a",{attrs:{href:"#三、路由"}},[s._v("三、路由")])]),a("li",[a("a",{attrs:{href:"#四、访问静态资源"}},[s._v("四、访问静态资源")])]),a("li",[a("a",{attrs:{href:"#五、中间件"}},[s._v("五、中间件")])])])]),a("p"),s._v(" "),a("hr"),s._v(" "),a("p",[a("code",[s._v("express")]),s._v(" 是一个基于 node.js 的 web 开发框架。")]),s._v(" "),a("h2",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),a("p",[s._v("express@4.7")]),s._v(" "),a("p",[s._v("node@16.7")]),s._v(" "),a("h2",{attrs:{id:"一、安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装"}},[s._v("#")]),s._v(" 一、安装")]),s._v(" "),a("p",[s._v("创建项目并初始化")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" myapp\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" myapp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" init\n")])])]),a("p",[s._v("安装 express 依赖")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -S express\n")])])]),a("h2",{attrs:{id:"二、跑起来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、跑起来"}},[s._v("#")]),s._v(" 二、跑起来")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const express = require('express');\n\nconst app = express();\n\n// 设置响应的路由\napp.get('/', function(req, res) {\n    res.send('hello world');\n})\n\n// 启动服务，并监听 3000 端口\napp.listen(3000, function() {\n    console.log('启动成功');\n})\n")])])]),a("h2",{attrs:{id:"三、路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、路由"}},[s._v("#")]),s._v(" 三、路由")]),s._v(" "),a("p",[s._v("路由由 URI 和请求方法构成，它决定了服务器如何响应客户端的请求。")]),s._v(" "),a("p",[s._v("1、路由的格式")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\napp 是 express 的实例\nmethod 是小写的 http 请求方法\npath 是请求路径\ncallback 定义如何响应客户端请求\n*/")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("method")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("2、添加路由")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// get 方法\napp.get('/get', function(req, res) {});\n// post 方法\napp.post('/post', function(req, res){});\n// 接受所有方法的请求\napp.all('/all', function(req, res){});\n\n")])])]),a("p",[s._v("3、路由路径")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 方式一：字符串\napp.get('/somepath', function(req, res) {})\n\n// 方式二：正则，将匹配 butterfly dragonfly 等等\napp.get(/.*fly$/, function(req, res) {})\n")])])]),a("p",[s._v("4、路由参数")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("app.get('/parameter/:name', function(req, res) {\n    console.log(req.params['name']);\n    res.send('parameter');\n})\n")])])]),a("p",[s._v("5、路由处理函数")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 用法一：基础用法\napp.get('/app', function(req, res){});\n\n// 用法二：链式调用\napp.get('/chain', function(req, res, next) {next()}, function(req, res){})\napp.get('/chain2', [callback1, callback2])\n\n// 用法三：链式调用2\napp.get('/echa', function(req, res, next) {\n\tnext('route'); // 流程转到另一个路由\n})\napp.get('/route', function(req, res) {});\n")])])]),a("p",[s._v("6、发回响应")]),s._v(" "),a("p",[a("code",[s._v("res.download()")]),s._v(" ，文件下载")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const path = require('path');\n// 第一个参数：是一个绝对文件路径\n// 第二个参数：下载文件的名称\nres.download(path.join(__dirname, '../public/image/29.jpg'), 'demo.jpg');\n")])])]),a("p",[a("code",[s._v("res.end()")]),s._v(" ，终止响应处理")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 调用后，就不能再发送数据了\nres.status(500).end();\n")])])]),a("p",[a("code",[s._v("res.json()")]),s._v("，响应一个 json")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("res.json({\n\tdata:data\n})\n")])])]),a("p",[a("code",[s._v("res.jsonp()")]),s._v(" ，类似 json()，默认的回调名是 "),a("code",[s._v("callback")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("res.jsonp({data:'data'})\n// => callback({\"data\": \"data\"})\n\n// 修改回调名\napp.set('jsonp callback name', 'cb');\n")])])]),a("p",[a("code",[s._v("res.redirect()")]),s._v("，重定向")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("res.redirect('/foo/bar');\n// 可以任何有效的 URI\n")])])]),a("p",[a("code",[s._v("res.render()")]),s._v("，渲染视图模板")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("res.render(view [, locals] [, callback])\n")])])]),a("p",[a("code",[s._v("res.send()")]),s._v("，发送不同类型的响应")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// someData 可以是 Buffer、String、Object、Boolean、Array\nres.send(someData);\n")])])]),a("p",[a("code",[s._v("res.sendFile()")]),s._v("，发送文件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("res.sendFile(path.join(__dirname, '../public', 'index1.html'));\n")])])]),a("p",[a("code",[s._v("res.sendStatus")]),s._v("，发送状态码和状态码描述")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// <=> res.status(200),send('OK');")]),s._v("\n")])])]),a("p",[s._v("7、嵌套路由")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// user.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" router "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" express"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用中间件")]),s._v("\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 添加路由")]),s._v("\nrouter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/info'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" router\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// index.js\nconst userRouter = require('./user.js');\n\napp.use('/user', userRouter); // => 访问 /user/info\n")])])]),a("h2",{attrs:{id:"四、访问静态资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、访问静态资源"}},[s._v("#")]),s._v(" 四、访问静态资源")]),s._v(" "),a("p",[s._v("目录结构")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("public\n--css\n----style.css\n--image\n----demo.png\nfile\n--demo.txt\nsrc\n--index.js\npackage.json\n")])])]),a("p",[s._v("启用静态资源中间件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// index.js\n// 相对地址是基于启动 node 应用的目录，推荐使用绝对目录\napp.use(express.static('static'));\n// 访问\nhttp://localhost:3000/image/demo.png\n")])])]),a("p",[s._v("多次使用静态资源中间件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// index.js\n\nconst path = require('path');\n\n//方式一：\napp.use(express.static('public'));\napp.use(express/static('file'));\n// 访问，会先去 public 查找，再去 file 查找，根据目录添加顺序进行查找\nhttp://localhost:3000/image/demo.png\n\n// 方式二：\napp.use('/static', express.static(path.join(__dirname, '..', 'public')));\napp.use('file', express/static('file'));\n// 访问\nhttp://localhost:3000/public/image/demo.png\nhttp://localhost:3000/file/demo.txt\n")])])]),a("h2",{attrs:{id:"五、中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、中间件"}},[s._v("#")]),s._v(" 五、中间件")]),s._v(" "),a("p",[s._v("中间件是一个传入  request, response, next 的函数。")]),s._v(" "),a("p",[s._v("1、中间件能做什么")]),s._v(" "),a("ul",[a("li",[s._v("执行任何代码")]),s._v(" "),a("li",[s._v("修改 request 和 response 对象")]),s._v(" "),a("li",[s._v("通过 next() 调用下一个中间件")]),s._v(" "),a("li",[s._v("发送响应")])]),s._v(" "),a("p",[s._v("2、编写中间件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var myLogger = function (req, res, next) {\n  console.log('LOGGED')\n  next()\n}\n\n// 可配置的中间件\nvar myLoggerPlus = function( options ) {\n\treturn function(req, res, next) {\n\t\tconsole.log('logger plus', options);\n\t\tnext();\n\t}\n}\n")])])]),a("p",[s._v("3-、使用中间件")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 1、应用级层面中间件，起始 app.get() 也是一种应用级层面中间件，如果没有指定挂在路径，每次收到请求就会执行\napp.use(muLogger);\napp.use('/logger', myLogger); // 访问 /logger 才会执行中间件\n// 使用可配置中间件\napp.use(myLoggerPlus({name:'dd'}));\n\n// 2、路由层级的中间件\nvar router = express.Router()\nrouter.use(muLogger);\nrouter.use('/logger', myLogger);\n\n// 3、错误处理中间件\napp.use(function (err, req, res, next) {\n  console.error(err.stack)\n  res.status(500).send('Something broke!')\n})\n")])])]),a("p",[s._v("4、内置中间件")]),s._v(" "),a("ul",[a("li",[s._v("express.static，静态资源文件")]),s._v(" "),a("li",[s._v("express.json，解析携带 JSON 数据的请求")]),s._v(" "),a("li",[s._v("express.urlencoded，解析 url")])]),s._v(" "),a("p",[s._v("5、"),a("a",{attrs:{href:"https://www.expressjs.com.cn/resources/middleware.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("第三方中间件列表"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);